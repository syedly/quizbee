{% extends 'base.html' %}
{% load static %}

{% block content %}
<div class="max-w-5xl mx-auto p-6">

  <!-- Server Header -->
  <div class="bg-white dark:bg-gray-800 p-6 rounded-2xl shadow-md mb-6 flex justify-between items-center">
    <div>
      <h1 class="text-3xl font-bold text-gray-900 dark:text-white">{{ server.name }}</h1>
      <p class="text-gray-600 dark:text-gray-300 mt-1">{{ server.description }}</p>
    </div>
    <button id="openMembersBtn"
      class="bg-indigo-600 text-white px-5 py-2 rounded-lg hover:bg-indigo-700 transition">
      ðŸ‘¥ Members
    </button>
  </div>

  <!-- Add Quiz Dropdown -->
  <div class="bg-white dark:bg-gray-800 p-6 rounded-2xl shadow-md mb-6">
    <h3 class="text-xl font-semibold mb-3 text-gray-900 dark:text-white">Add Your Quiz to This Server</h3>

    <form action="{% url 'add_quiz_to_server' server.id %}" method="POST" class="flex items-center gap-3">
      {% csrf_token %}
      <select name="quiz_id" required
        class="border border-gray-300 dark:border-gray-700 rounded-lg px-4 py-2 w-full bg-gray-50 dark:bg-gray-700 text-gray-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-indigo-500">
        <option value="">-- Select a Quiz --</option>
        {% for quiz in quizes %}
        <option value="{{ quiz.id }}">{{ quiz.topic }} ({{ quiz.difficulty }})</option>
        {% empty %}
        <option disabled>No quizzes available</option>
        {% endfor %}
      </select>

      <button type="submit"
        class="bg-green-600 hover:bg-green-700 text-white px-5 py-2 rounded-lg transition">
        âž• Add
      </button>
    </form>
  </div>

  <!-- Quizzes Section -->
  <div class="bg-white dark:bg-gray-800 p-6 rounded-2xl shadow-md">
    <h3 class="text-2xl font-semibold mb-4 text-gray-900 dark:text-white">Available Quizzes</h3>
    <ul class="space-y-3">
      {% for sq in quizzes %}
      <li class="p-4 border rounded-lg bg-gray-50 dark:bg-gray-700 flex justify-between items-center">
        <div>
          <span class="font-semibold text-gray-900 dark:text-gray-100">{{ sq.quiz.topic }}</span>
          <span class="text-sm text-gray-500 dark:text-gray-400">({{ sq.quiz.difficulty }})</span>
        </div>

        {% if sq.quiz.id in attempted_quiz %}
        <span class="text-green-600 dark:text-green-400 font-semibold">âœ… Already Taken</span>
        {% else %}
        <a href="{% url 'quiz_take' sq.quiz.id %}"
          class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition">
          Take Quiz
        </a>
        {% endif %}
      </li>
      {% empty %}
      <p class="text-gray-500 dark:text-gray-400">No quizzes assigned yet.</p>
      {% endfor %}
    </ul>
  </div>

</div>

<!-- Members Modal -->
<div id="membersModal" class="fixed inset-0 bg-black bg-opacity-50 hidden justify-center items-center z-50">
  <div class="bg-white dark:bg-gray-900 rounded-2xl shadow-lg w-96 p-6 relative">
    <h2 class="text-xl font-semibold text-gray-900 dark:text-white mb-4">Server Members</h2>

    <ul class="max-h-60 overflow-y-auto divide-y divide-gray-200 dark:divide-gray-700">
      {% for member in members %}
      <li class="py-2 text-gray-800 dark:text-gray-200">
        ðŸ‘¤ {{ member.username }}
      </li>
      {% empty %}
      <p class="text-gray-500 dark:text-gray-400 text-center">No members yet.</p>
      {% endfor %}
    </ul>

    <button id="closeMembersBtn"
      class="absolute top-3 right-3 text-gray-600 dark:text-gray-300 hover:text-gray-900 dark:hover:text-white text-xl">
      âœ•
    </button>
  </div>
</div>

<!-- JS for Modal -->
<script>
  const modal = document.getElementById('membersModal');
  const openBtn = document.getElementById('openMembersBtn');
  const closeBtn = document.getElementById('closeMembersBtn');

  openBtn.addEventListener('click', () => modal.classList.remove('hidden'));
  closeBtn.addEventListener('click', () => modal.classList.add('hidden'));
  window.addEventListener('click', (e) => {
    if (e.target === modal) modal.classList.add('hidden');
  });
</script>
{% endblock %}
