{% extends "base.html" %}
{% block content %}
<div class="max-w-3xl mx-auto bg-white dark:bg-gray-900 p-6 rounded-2xl shadow-md mt-6">
  <div class="flex justify-between items-center mb-4">
    <div>
      <h2 class="text-2xl font-bold text-gray-800 dark:text-white">{{ server.name }}</h2>
      <p class="text-gray-500 dark:text-gray-400">{{ server.description }}</p>
      <p class="text-sm text-gray-400 mt-1">
        <strong>Join Code:</strong> {{ server.code }}
      </p>
    </div>

    <!-- If user is the creator, show "Add Quiz" button -->
    {% if request.user == server.created_by %}
    <button 
      onclick="document.getElementById('addQuizModal').showModal()" 
      class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg transition">
      + Add Quiz
    </button>
    {% endif %}
  </div>

  <hr class="border-gray-300 dark:border-gray-700 my-4">

  <h3 class="text-xl font-semibold mb-2 text-gray-800 dark:text-white">Available Quizzes</h3>
  <ul class="space-y-3">
    {% for sq in quizzes %}
      <li class="p-4 border rounded-lg bg-gray-50 dark:bg-gray-800">
        <span class="font-semibold">{{ sq.quiz.topic }}</span>
        <span class="text-sm text-gray-500">({{ sq.quiz.difficulty }})</span>
      </li>
    {% empty %}
      <p class="text-gray-500">No quizzes assigned yet.</p>
    {% endfor %}
  </ul>
</div>

<!-- Add Quiz Modal -->
{% if request.user == server.created_by %}
<dialog id="addQuizModal" class="rounded-lg p-6 bg-white dark:bg-gray-900 shadow-lg">
  <form method="POST" action="{% url 'add_quiz_to_server' server.id %}">
    {% csrf_token %}
    <h3 class="text-lg font-semibold mb-3 text-gray-800 dark:text-white">Add Quiz to Server</h3>
    
    <label class="block mb-2 text-gray-700 dark:text-gray-300">Select a Quiz:</label>
    <select name="quiz_id" class="border border-gray-300 dark:border-gray-700 rounded-md p-2 w-full mb-4">
        {% for quiz in quizes %}
            <option value="{{ quiz.id }}">{{ quiz.topic }} ({{ quiz.difficulty }})</option>
        {% endfor %}
    </select>


    <div class="flex justify-end space-x-2">
      <button type="button" onclick="this.closest('dialog').close()" 
              class="px-4 py-2 rounded-lg bg-gray-200 hover:bg-gray-300 dark:bg-gray-800 dark:hover:bg-gray-700">
        Cancel
      </button>
      <button type="submit" 
              class="px-4 py-2 rounded-lg bg-blue-600 hover:bg-blue-700 text-white">
        Add Quiz
      </button>
    </div>
  </form>
</dialog>
{% endif %}
{% endblock %}
