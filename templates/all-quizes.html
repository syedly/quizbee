{% extends "base.html" %}
{% load static %}
{% block title %}All Quizzes{% endblock title %}

{% block content %}
<main class="flex-1 p-4 sm:p-6 bg-background-light dark:bg-background-dark">
  <div class="bg-white dark:bg-primary/10 rounded-xl shadow-md overflow-hidden">
    <div class="overflow-x-auto">
      <table class="w-full text-left">
        <thead class="border-b border-primary/20 dark:border-primary/30">
          <tr>
            <th class="px-6 py-4 text-sm font-semibold text-slate-600 dark:text-slate-300">Quiz Title</th>
            <th class="px-6 py-4 text-sm font-semibold text-slate-600 dark:text-slate-300">Difficulty</th>
            <th class="px-6 py-4 text-sm font-semibold text-slate-600 dark:text-slate-300 text-center">Public</th>
            <th class="px-6 py-4 text-sm font-semibold text-slate-600 dark:text-slate-300 text-center">Actions</th>
          </tr>
        </thead>
        <tbody>
          {% for quiz in page_obj %}
          <tr class="border-b border-primary/10 dark:border-primary/20">
            <!-- Quiz Title -->
            <td class="px-6 py-4 whitespace-nowrap text-slate-800 dark:text-white font-medium">
              <i class="fa-solid fa-circle-question mr-2"></i> {{ quiz.topic }}
            </td>

            <!-- Difficulty -->
            <td class="px-6 py-4">
              <div class="w-32 bg-slate-200 dark:bg-slate-700 rounded-full h-2">
                <div class="bg-green-500 h-2 rounded-full" 
                     style="width: {{ quiz.difficulty|add:"0" }}0%"></div>
              </div>
              <span class="text-xs text-slate-500 dark:text-slate-400">
                {% if quiz.difficulty == 1 %} Easy
                {% elif quiz.difficulty == 2 %} Medium
                {% elif quiz.difficulty == 3 %} Hard
                {% else %} Custom
                {% endif %}
              </span>
            </td>

            <!-- Public Checkbox -->
            <td class="px-6 py-4 text-center">
              <form method="post" action="{% url 'is_public' quiz.id %}">
                {% csrf_token %}
                <input type="checkbox" name="is_public" onchange="this.form.submit()"
                       {% if quiz.is_public %}checked{% endif %}
                       class="h-5 w-5 rounded border-gray-300 text-primary focus:ring-primary">
              </form>
            </td>

            <!-- Actions -->
            <td class="px-6 py-4 text-center">
              <div class="flex justify-center items-center space-x-3">
                {% if quiz.attempted %}
                  <!-- Retake -->
                  <a href="{% url 'retake_quiz' quiz.id %}" class="icon-btn group relative">
                    <span class="material-symbols-outlined">refresh</span>
                    <span class="tooltip">Retake Quiz</span>
                  </a>
                  <!-- View Result -->
                  <a href="{% url 'quizz_result' quiz.attempt.id %}" class="icon-btn group relative">
                    <span class="material-symbols-outlined">visibility</span>
                    <span class="tooltip">View Result</span>
                  </a>
                {% else %}
                  <!-- Take Quiz -->
                  <a href="{% url 'quiz_take' quiz.id %}" class="icon-btn group relative">
                    <span class="material-symbols-outlined">play_arrow</span>
                    <span class="tooltip">Start Quiz</span>
                  </a>
                {% endif %}

                <!-- Info -->
                <a href="{% url 'quizz_detail' quiz.id %}" class="icon-btn group relative">
                  <span class="material-symbols-outlined">info</span>
                  <span class="tooltip">Quiz Details</span>
                </a>

                <!-- Share -->
                <button type="button" class="icon-btn group relative" onclick="openShareModal({{ quiz.id }})">
                  <span class="material-symbols-outlined">share</span>
                  <span class="tooltip">Share Quiz</span>
                </button>

                <!-- Delete -->
                <a href="{% url 'delete_quiz' quiz.id %}" class="icon-btn text-red-500 group relative">
                  <span class="material-symbols-outlined">delete</span>
                  <span class="tooltip">Delete Quiz</span>
                </a>
              </div>
            </td>
          </tr>
          {% empty %}
          <tr>
            <td colspan="4" class="px-6 py-4 text-center text-slate-500 dark:text-slate-400">
              No quizzes yet
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>

  <!-- Pagination -->
  {% if page_obj.has_other_pages %}
  <div class="flex justify-center mt-4 space-x-2">
    {% if page_obj.has_previous %}
      <a href="?page={{ page_obj.previous_page_number }}" class="px-3 py-1 rounded bg-primary text-white">Previous</a>
    {% endif %}

    <span class="px-3 py-1 rounded bg-slate-200 dark:bg-slate-700 text-slate-700 dark:text-slate-200">
      Page {{ page_obj.number }} of {{ page_obj.paginator.num_pages }}
    </span>

    {% if page_obj.has_next %}
      <a href="?page={{ page_obj.next_page_number }}" class="px-3 py-1 rounded bg-primary text-white">Next</a>
    {% endif %}
  </div>
  {% endif %}
</main>

<!-- Share Modal -->
<div id="shareModal" class="fixed inset-0 z-50 hidden bg-black bg-opacity-50 flex justify-center items-center">
  <div class="bg-white dark:bg-slate-800 rounded-lg shadow-lg w-96 p-6">
    <h3 class="text-lg font-semibold mb-4 text-slate-800 dark:text-slate-200">Share Quiz</h3>
    <form id="shareForm" method="post" action="">
      {% csrf_token %}
      <input type="hidden" name="quiz_id" id="quizId">
      <input type="text" name="username" placeholder="Enter username"
             class="w-full px-3 py-2 border rounded mb-4 dark:bg-slate-700 dark:text-white">
      <div class="flex justify-end space-x-2">
        <button type="button" onclick="closeShareModal()" class="px-4 py-2 rounded bg-gray-300 dark:bg-gray-600">Cancel</button>
        <button type="submit" class="px-4 py-2 rounded bg-primary text-white">Share</button>
      </div>
    </form>
  </div>
</div>

<style>
/* Tooltip Styling */
.tooltip {
  visibility: hidden;
  opacity: 0;
  position: absolute;
  bottom: 125%; /* above the icon */
  left: 50%;
  transform: translateX(-50%);
  background: #111;
  color: #fff;
  font-size: 12px;
  padding: 4px 8px;
  border-radius: 6px;
  white-space: nowrap;
  transition: opacity 0.2s ease;
}
.group:hover .tooltip {
  visibility: visible;
  opacity: 1;
}
</style>

<script src="{% static 'js/allQuizes.js' %}"></script>
{% endblock content %}
